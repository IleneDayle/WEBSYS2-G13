<!DOCTYPE html>
<html>
    <head>
        <title><%= title %></title>
        <link rel="stylesheet" href="/css/styles.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>

    <body>
        <nav class="navbar">
            <span class="brand">
                <a href="/">SpinCycle Laundry</a>
            </span>
            <div class="auth">
                <a href="/">Home</a>
                <a href="/users/login">Login</a>
            </div>
        </nav>

        <div class="main-content">
            <h1>Join SpinCycle</h1>
            
            <form action="/users/register" method="POST">
                <label for="firstName">First Name</label>
                <input type="text" id="firstName" name="firstName" required placeholder="Enter your first name">
                
                <label for="lastName">Last Name</label>
                <input type="text" id="lastName" name="lastName" required placeholder="Enter your last name">
                
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" required placeholder="Enter your email address">
                
                <label for="password">Password</label>
                <div class="input-with-toggle">
                    <input type="password" id="password" name="password" required placeholder="Create a strong password">
                    <button type="button" class="toggle-btn" id="togglePassword" aria-label="Show password">
                        <span class="toggle-icon"></span>
                    </button>
                </div>
                
                <div id="password-criteria">
                    <h3 style="margin-bottom: 16px; color: #2d3748; font-size: 1em;">Password Requirements:</h3>
                    <ul style="list-style: none; padding: 0; margin: 0;">
                        <li id="length">At least 8 characters long</li>
                        <li id="uppercase">Contains at least one uppercase letter</li>
                        <li id="lowercase">Contains at least one lowercase letter</li>
                        <li id="number">Contains at least one number</li>
                        <li id="special">Contains at least one special character (!@#$%^&*)</li>
                    </ul>
                </div>
                
                <button type="submit" disabled>Create Account</button>

                <div style="text-align: center; margin-top: 24px;">
                    <p>Already have an account? <a href="/users/login">Sign in here</a></p>
                </div>
            </form>
        </div>

        <footer>
            <p>&copy; 2025 SpinCycle Laundry. Making laundry effortless.</p>
        </footer>

        <script>
            const passwordInput = document.getElementById('password');
            const firstNameInput = document.getElementById('firstName');
            const lastNameInput = document.getElementById('lastName');
            const emailInput = document.getElementById('email');
            const submitBtn = document.querySelector('button[type="submit"]');

            function validatePassword(pw) {
                return {
                    length: pw.length >= 8,
                    uppercase: /[A-Z]/.test(pw),
                    lowercase: /[a-z]/.test(pw),
                    number: /\d/.test(pw),
                    special: /[!@#$%^&*(),.?":{}|<>]/.test(pw)
                };
            }

            function updateCriteria() {
                const pw = passwordInput.value;
                const criteria = validatePassword(pw);

                // Update visual feedback for each criterion
                Object.keys(criteria).forEach(key => {
                    const element = document.getElementById(key);
                    element.style.color = criteria[key] ? '#38a169' : '#e53e3e';
                });

                // Check if all fields are filled and criteria are met
                const allFieldsFilled = firstNameInput.value && lastNameInput.value && emailInput.value && pw;
                const allCriteriaMet = Object.values(criteria).every(Boolean);
                
                submitBtn.disabled = !(allFieldsFilled && allCriteriaMet);
                
                // Update button appearance based on state
                if (submitBtn.disabled) {
                    submitBtn.style.opacity = '0.6';
                    submitBtn.style.cursor = 'not-allowed';
                } else {
                    submitBtn.style.opacity = '1';
                    submitBtn.style.cursor = 'pointer';
                }
            }

            // Add event listeners
            passwordInput.addEventListener('input', updateCriteria);
            firstNameInput.addEventListener('input', updateCriteria);
            lastNameInput.addEventListener('input', updateCriteria);
            emailInput.addEventListener('input', updateCriteria);

            // Styled eye toggle for register password (SVG icons)
            (function(){
                const btn = document.getElementById('togglePassword');
                const icon = btn && btn.querySelector('.toggle-icon');
                if (!btn || !icon || !passwordInput) return;

                const ICON_SHOW = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"/><circle cx="12" cy="12" r="3"/></svg>';
                const ICON_HIDE = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.94 10.94 0 0 1 12 20c-7 0-11-8-11-8a21.25 21.25 0 0 1 5.06-6.94"/><path d="M1 1l22 22"/></svg>';

                icon.innerHTML = ICON_SHOW;

                btn.addEventListener('click', function() {
                    const isText = passwordInput.type === 'text';
                    passwordInput.type = isText ? 'password' : 'text';
                    btn.setAttribute('aria-label', isText ? 'Show password' : 'Hide password');
                    icon.innerHTML = isText ? ICON_SHOW : ICON_HIDE;
                });
            })();

            // Initial validation state
            updateCriteria();

            // Add form submission validation
            document.querySelector('form').addEventListener('submit', function(e) {
                const pw = passwordInput.value;
                const criteria = validatePassword(pw);
                const allFieldsFilled = firstNameInput.value && lastNameInput.value && emailInput.value && pw;
                const allCriteriaMet = Object.values(criteria).every(Boolean);
                
                if (!allFieldsFilled || !allCriteriaMet) {
                    e.preventDefault();
                    alert('Please fill all fields and ensure password meets all requirements.');
                    return false;
                }
            });
        </script>
    </body>
</html>