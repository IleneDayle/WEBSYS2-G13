<!DOCTYPE html>
<html>
    <head>
        <title><%= title %></title>
        <link rel="stylesheet" href="/public/css/styles.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            .admin-header {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 40px;
                border-radius: 20px;
                margin: 20px 0 40px;
                text-align: center;
            }
            
            .admin-header h1 {
                color: white;
                margin-bottom: 16px;
                background: none;
                -webkit-text-fill-color: white;
            }
            
            .admin-nav {
                display: flex;
                gap: 12px;
                margin-bottom: 30px;
                flex-wrap: wrap;
            }
            
            .admin-nav a {
                padding: 12px 20px;
                background: #f0f4f8;
                color: #667eea;
                text-decoration: none;
                border-radius: 10px;
                font-weight: 600;
                transition: all 0.3s ease;
            }
            
            .admin-nav a:hover,
            .admin-nav a.active {
                background: #667eea;
                color: white;
            }
            
            .reports-stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin: 30px 0;
            }
            
            .stat-card {
                background: white;
                padding: 24px;
                border-radius: 16px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(226, 232, 240, 0.8);
            }
            
            .stat-number {
                font-size: 2.5em;
                font-weight: 700;
                color: #667eea;
                margin-bottom: 8px;
            }
            
            .stat-label {
                color: #64748b;
                font-size: 0.9em;
                text-transform: uppercase;
                letter-spacing: 1px;
                font-weight: 600;
            }
            
            .filter-section {
                background: white;
                padding: 24px;
                border-radius: 16px;
                margin-bottom: 30px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(226, 232, 240, 0.8);
            }
            
            .filter-controls {
                display: flex;
                gap: 16px;
                flex-wrap: wrap;
                align-items: center;
            }
            
            .filter-btn {
                padding: 10px 16px;
                border: 2px solid #e2e8f0;
                background: white;
                border-radius: 10px;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s ease;
            }
            
            .filter-btn:hover,
            .filter-btn.active {
                background: #667eea;
                color: white;
                border-color: #667eea;
            }
            
            .reports-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 24px;
                margin-top: 30px;
            }
            
            @media (max-width: 1200px) {
                .reports-container {
                    grid-template-columns: 1fr;
                }
            }
            
            .report-section {
                background: white;
                padding: 24px;
                border-radius: 16px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(226, 232, 240, 0.8);
            }
            
            .report-section h3 {
                margin-top: 0;
                color: #2d3748;
                border-bottom: 2px solid #667eea;
                padding-bottom: 12px;
            }
            
            .report-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 16px;
            }
            
            .report-table th {
                background: #f9fafb;
                padding: 12px;
                text-align: left;
                font-weight: 600;
                color: #2d3748;
                border-bottom: 2px solid #e2e8f0;
            }
            
            .report-table td {
                padding: 12px;
                border-bottom: 1px solid #e2e8f0;
            }
            
            .report-table tr:hover {
                background: #f9fafb;
            }
            
            .revenue-highlight {
                color: #10b981;
                font-weight: 700;
            }
            
            .order-count {
                background: #dbeafe;
                color: #0c4a6e;
                padding: 4px 8px;
                border-radius: 4px;
                font-weight: 600;
                display: inline-block;
            }
        </style>
    </head>

    <body>
        <nav class="navbar">
            <span class="brand">
                <a href="/">SpinCycle Laundry - Admin</a>
            </span>
            <div class="auth">
                <a href="/users/dashboard">Dashboard</a>
                <a href="/users/logout">Logout</a>
            </div>
        </nav>

        <div class="main-content">
            <div class="dashboard-container">
                <div class="admin-header">
                    <h1>Sales Reports</h1>
                    <p>Welcome, <%= currentUser.firstName %> | Comprehensive Sales Analytics</p>
                </div>

                <!-- Admin Navigation -->
                <div class="admin-nav">
                    <a href="/users/admin">Dashboard</a>
                    <a href="/admin/orders">Orders</a>
                    <a href="/admin/payments">Payments</a>
                    <a href="/admin/support">Support</a>
                    <a href="/admin/services">Services</a>
                    <a href="/admin/reports" class="active">Reports</a>
                </div>

                <!-- Filter Section -->
                <div class="filter-section">
                    <h3 style="margin-top: 0; margin-bottom: 12px; color: #2d3748; font-size: 1em;">Filter Reports</h3>
                    <form method="GET" action="/admin/reports" style="display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-end;">
                        <div style="flex: 1; min-width: 160px;">
                            <label for="status" style="display: block; margin-bottom: 4px; font-weight: 600; color: #333; font-size: 0.85em;">Status</label>
                            <select name="status" id="status" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.9em;">
                                <option value="">All</option>
                                <option value="pending" <%= filterStatus === 'pending' ? 'selected' : '' %>>Pending</option>
                                <option value="processing" <%= filterStatus === 'processing' ? 'selected' : '' %>>Processing</option>
                                <option value="completed" <%= filterStatus === 'completed' ? 'selected' : '' %>>Completed</option>
                                <option value="cancelled" <%= filterStatus === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
                            </select>
                        </div>
                        <div style="flex: 1; min-width: 160px;">
                            <label for="service" style="display: block; margin-bottom: 4px; font-weight: 600; color: #333; font-size: 0.85em;">Service</label>
                            <input type="text" name="service" id="service" placeholder="Search..." value="<%= filterService %>" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.9em;">
                        </div>
                        <div style="flex: 1; min-width: 130px;">
                            <label for="dateFrom" style="display: block; margin-bottom: 4px; font-weight: 600; color: #333; font-size: 0.85em;">From</label>
                            <input type="date" name="dateFrom" id="dateFrom" value="<%= filterDateFrom %>" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.9em;">
                        </div>
                        <div style="flex: 1; min-width: 130px;">
                            <label for="dateTo" style="display: block; margin-bottom: 4px; font-weight: 600; color: #333; font-size: 0.85em;">To</label>
                            <input type="date" name="dateTo" id="dateTo" value="<%= filterDateTo %>" style="width: 100%; padding: 8px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.9em;">
                        </div>
                        <button type="submit" style="padding: 8px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; font-size: 0.9em;">Apply</button>
                        <a href="/admin/reports" style="padding: 8px 16px; background: #e2e8f0; color: #667eea; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 0.9em;">Clear</a>
                            <a href="/admin/reports/export/excel?<%= new URLSearchParams({ status: filterStatus || '', service: filterService || '', dateFrom: filterDateFrom || '', dateTo: filterDateTo || '' }).toString() %>" style="padding: 8px 16px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 0.9em;">ðŸ“Š Export Excel</a>
                            <a href="/admin/reports/export/pdf?<%= new URLSearchParams({ status: filterStatus || '', service: filterService || '', dateFrom: filterDateFrom || '', dateTo: filterDateTo || '' }).toString() %>" style="padding: 8px 16px; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 0.9em;">ðŸ“„ Export PDF</a>
                    </form>
                </div>

                <!-- Key Metrics -->
                <div class="reports-stats">
                    <div class="stat-card">
                        <div class="stat-number">â‚±<%= reportsData.totalRevenue %></div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number"><%= reportsData.totalOrders %></div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">â‚±<%= reportsData.avgOrderValue %></div>
                        <div class="stat-label">Average Order Value</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number"><%= reportsData.completedOrders %></div>
                        <div class="stat-label">Completed Orders</div>
                    </div>
                </div>

                <!-- Order Status Filter -->
                <div class="filter-section">
                    <h3 style="margin-top: 0; margin-bottom: 16px;">Order Status Distribution</h3>
                    <div class="filter-controls">
                        <div style="padding: 12px 16px; background: #d1fae5; border-radius: 10px; color: #065f46; font-weight: 600;">
                            Completed: <span style="font-size: 1.3em;"><%= reportsData.completedOrders %></span>
                        </div>
                        <div style="padding: 12px 16px; background: #fef3c7; border-radius: 10px; color: #92400e; font-weight: 600;">
                            Pending: <span style="font-size: 1.3em;"><%= reportsData.pendingOrders %></span>
                        </div>
                        <div style="padding: 12px 16px; background: #fee2e2; border-radius: 10px; color: #991b1b; font-weight: 600;">
                            Cancelled: <span style="font-size: 1.3em;"><%= reportsData.cancelledOrders %></span>
                        </div>
                    </div>
                </div>

                <!-- Reports Grid -->
                <div class="reports-container">
                    <!-- Sales by Service -->
                    <div class="report-section">
                        <h3>Sales by Service</h3>
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>Service</th>
                                    <th>Orders</th>
                                    <th>Revenue</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% Object.keys(reportsData.salesByService).forEach(service => { %>
                                    <tr>
                                        <td><strong><%= service %></strong></td>
                                        <td><span class="order-count"><%= reportsData.salesByService[service].count %></span></td>
                                        <td><span class="revenue-highlight">â‚±<%= reportsData.salesByService[service].revenue %></span></td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>

                    <!-- Top Customers -->
                    <div class="report-section">
                        <h3>Top Customers</h3>
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>Customer</th>
                                    <th>Orders</th>
                                    <th>Total Spent</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% 
                                    const topCustomers = Object.entries(reportsData.salesByUser)
                                        .sort((a, b) => b[1].revenue - a[1].revenue)
                                        .slice(0, 10);
                                    
                                    topCustomers.forEach(([email, data]) => {
                                %>
                                    <tr>
                                        <td>
                                            <strong><%= data.userName || email %></strong>
                                            <br><span style="font-size: 0.85em; color: #64748b;"><%= email %></span>
                                        </td>
                                        <td><span class="order-count"><%= data.count %></span></td>
                                        <td><span class="revenue-highlight">â‚±<%= data.revenue %></span></td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- All Users Sales Report -->
                <div class="report-section" style="margin-top: 30px;">
                    <h3>All Users Sales Details</h3>
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>Customer Name</th>
                                <th>Email</th>
                                <th>Orders</th>
                                <th>Total Revenue</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% 
                                Object.entries(reportsData.salesByUser)
                                    .sort((a, b) => b[1].revenue - a[1].revenue)
                                    .forEach(([email, data]) => {
                            %>
                                <tr>
                                    <td><strong><%= data.userName || 'Unknown' %></strong></td>
                                    <td><%= email %></td>
                                    <td><span class="order-count"><%= data.count %></span></td>
                                    <td><span class="revenue-highlight">â‚±<%= data.revenue %></span></td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <footer>
            <p>&copy; 2025 SpinCycle Laundry. Making laundry effortless.</p>
        </footer>
    </body>
</html>
