<!DOCTYPE html>
<html>
    <head>
        <title><%= title %></title>
        <link rel="stylesheet" href="/public/css/styles.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <nav class="navbar">
            <span class="brand"><a href="/">SpinCycle Laundry</a></span>
            <div class="auth">
                <a href="/users/dashboard">Dashboard</a>
                <a href="/users/logout">Logout</a>
            </div>
        </nav>

        <div class="main-content">
            <h1 style="text-align: center; margin-bottom: 30px;">Order Details</h1>
            <div style="max-width:800px; margin:20px auto; background:white; padding:30px; border-radius:12px; border:1px solid #e2e8f0; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div>
                        <p style="font-size: 0.85em; color: #64748b; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Order ID</p>
                        <p style="margin: 0; color: #2d3748; font-family: monospace; font-weight: 500;"><%= order._id %></p>
                    </div>
                    <div>
                        <p style="font-size: 0.85em; color: #64748b; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Service</p>
                        <p style="margin: 0; color: #2d3748; font-weight: 600; font-size: 1.1em;"><%= order.serviceName %></p>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div>
                        <p style="font-size: 0.85em; color: #64748b; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Pickup Date</p>
                        <p style="margin: 0; color: #2d3748; font-weight: 500;">
                            <%= order.pickupDate ? new Date(order.pickupDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : 'TBD' %>
                        </p>
                    </div>
                    <div>
                        <p style="font-size: 0.85em; color: #64748b; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Price</p>
                        <p style="margin: 0; color: #2d3748; font-weight: 600; font-size: 1.2em;">₱<%= order.price %></p>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div>
                        <p style="font-size: 0.85em; color: #64748b; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Status</p>
                        <% 
                            var statusBg = '#fef3c7';
                            var statusText = '#92400e';
                            if (order.status === 'completed') {
                                statusBg = '#d1fae5';
                                statusText = '#065f46';
                            } else if (order.status === 'cancelled') {
                                statusBg = '#fee2e2';
                                statusText = '#991b1b';
                            } else if (order.status === 'shipped') {
                                statusBg = '#dbeafe';
                                statusText = '#0c4a6e';
                            }
                        %>
                        <span style="background-color: <%= statusBg %>; color: <%= statusText %>; padding: 10px 14px; border-radius: 6px; font-weight: 600; display: inline-block;">
                            <%= order.status || 'pending' %>
                        </span>
                    </div>
                    <div>
                        <p style="font-size: 0.85em; color: #64748b; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Payment</p>
                        <span style="background-color: <%= order.paymentStatus === 'paid' ? '#d1fae5' : '#fef3c7' %>; color: <%= order.paymentStatus === 'paid' ? '#065f46' : '#92400e' %>; padding: 10px 14px; border-radius: 6px; font-weight: 600; display: inline-block;">
                            <%= order.paymentStatus || 'unpaid' %>
                        </span>
                    </div>
                </div>

                <% if (order.notes) { %>
                    <div style="margin-bottom: 30px; padding: 16px; background-color: #f9fafb; border-radius: 8px; border-left: 4px solid #667eea;">
                        <p style="font-size: 0.85em; color: #64748b; margin: 0 0 8px 0; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">Notes</p>
                        <p style="margin: 0; color: #2d3748; line-height: 1.6;"><%= order.notes %></p>
                    </div>
                <% } %>

                <% if (user.role === 'admin') { %>
                    <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e2e8f0;">
                        <h3 style="margin-top: 0; color: #2d3748;">Admin: Update Status</h3>
                        <form method="POST" action="/orders/<%= order._id %>/status" style="display: flex; gap: 12px; flex-wrap: wrap;">
                            <select name="status" style="padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 1em; cursor: pointer;">
                                <option value="pending" <%= order.status === 'pending' ? 'selected' : '' %>>Pending</option>
                                <option value="shipped" <%= order.status === 'shipped' ? 'selected' : '' %>>Shipped</option>
                                <option value="completed" <%= order.status === 'completed' ? 'selected' : '' %>>Completed</option>
                                <option value="cancelled" <%= order.status === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
                            </select>
                            <button type="submit" style="background-color: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">Update Status</button>
                        </form>
                    </div>
                <% } %>

                <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e2e8f0; display: flex; gap: 12px; flex-wrap: wrap;">
                    <% if (order.paymentStatus !== 'paid') { %>
                        <form method="POST" action="/billing/pay/<%= order._id %>" style="display: flex;">
                            <input type="hidden" name="method" value="card">
                            <button type="submit" style="background-color: #10b981; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">Pay ₱<%= order.price %></button>
                        </form>
                    <% } %>
                    <a href="/orders/my" style="background-color: #e2e8f0; color: #2d3748; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; text-decoration: none; display: inline-block;">Back to Orders</a>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2025 SpinCycle Laundry.</p>
        </footer>
    </body>
</html>
